# go build
FROM container-registry.example.com/library/golang-alpine:latest
ARG SERVICE=example-service
WORKDIR /app

COPY . .
RUN go get -d

ENV APP_SERVER_HOST=
ENV APP_SERVER_PORT=
ENV KAFKA_BOOTSTRAP_SERVERS=
ENV KAFKA_CONSUMER_GROUP_ID=
ENV POSTGRES_USER=
ENV POSTGRES_PASSWORD=
ENV POSTGRES_DBNAME=
ENV POSTGRES_HOST=
ENV POSTGRES_PORT=
ENV POSTGRES_SSL_MODE=
ENV POSTGRES_URI=
ENV POSTGRES_CONNECTION_QUERY_STRING=
ENV OAUTH2_CLIENT_CLIENT_ID=
ENV OAUTH2_CLIENT_CLIENT_SECRET=
ENV OAUTH2_CLIENT_USER_AUTHORIZATION_URI=
ENV ORIGINS_ALLOWED=
ENV APP_SERVER_MIGRATIONS_FOLDER=

RUN GOOS=linux GOARCH=amd64 go build -a -v -tags musl -o ${SERVICE}
RUN go clean -modcache -r

EXPOSE 5000
ENTRYPOINT [ "/app/example-service" ]
